ğŸ§© MÃ“DULO 1 â€” Arquitectura Interna de Maven
ğŸ¯ Objetivo del mÃ³dulo

Comprender los componentes internos de Maven â€”cÃ³mo se comunican y quÃ© responsabilidades tiene cada unoâ€” para entender quÃ© pasa cuando ejecutas un simple:

mvn clean install

ğŸ”¹ 1. FilosofÃ­a de Maven: Declarativo y determinista

A diferencia de herramientas imperativas (como Ant o scripts shell), Maven no ejecuta pasos uno por uno escritos por el usuario, sino que:

Lee un modelo declarativo (pom.xml).

Construye un modelo de proyecto (POM) en memoria.

Determina automÃ¡ticamente quÃ© fases y objetivos deben ejecutarse.

Usa metadatos, convenciones y dependencias para reproducir siempre el mismo resultado.

ğŸ“Œ Maven es un motor de ejecuciÃ³n de â€œmodelos de construcciÃ³nâ€, no solo una herramienta de compilaciÃ³n.




ğŸ”¹ 2. Componentes Clave Internos

ğŸ§± a) Project Object Model (POM)

El corazÃ³n de Maven.
Cuando Maven arranca, lo primero que hace es leer el archivo pom.xml y construir un POM model en memoria.

Internamente:

Usa clases de maven-model y maven-model-builder.

Combina:

pom.xml local

POMs padres (<parent>)

BOMs (<dependencyManagement>)

Propiedades del sistema

Perfiles activos

Resultado: un modelo completamente interpolado, listo para construir.

Ejemplo:
<project>
  <modelVersion>4.0.0</modelVersion>
  <parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>3.2.5</version>
  </parent>
  <dependencies>
    <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
  </dependencies>
</project>


â¡ï¸ Maven fusiona este POM con el del parent (Spring Boot Starter Parent), hereda propiedades, plugins y versiones.




âš™ï¸ b) Reactor

El Reactor es el cerebro que coordina la construcciÃ³n cuando hay mÃºltiples mÃ³dulos.

Su funciÃ³n:

Lee todos los mÃ³dulos (<modules> en el POM raÃ­z).

Construye un grafo de dependencias entre mÃ³dulos locales.

Ordena la compilaciÃ³n en topologÃ­a (build order).

Ejecuta los mÃ³dulos en secuencia (o en paralelo si usas -T).

Ejemplo:
<modules>
  <module>core</module>
  <module>api</module>
  <module>plugin</module>
</modules>


Si api depende de core, el reactor ejecuta primero core, luego api, finalmente plugin.

ğŸ“˜ Internamente:
Usa ReactorBuildExecutor y MavenSession para coordinar fases y aislar contextos de ejecuciÃ³n.




ğŸ§© c) Plugin Manager

Cada â€œgoalâ€ (mvn clean, mvn compile, etc.) corresponde a un plugin con una o mÃ¡s metas (mojos = Maven plain old Java objects).

Proceso interno:

Maven resuelve el plugin desde el repositorio.

Carga su descriptor (plugin.xml) con las metas disponibles.

Inyecta el contexto del proyecto (MavenProject, Session, Settings).

Ejecuta el mÃ©todo execute() del mojo correspondiente.

Ejemplo:
mvn compiler:compile


ğŸ”¸ Invoca el maven-compiler-plugin,
ğŸ”¸ Busca su meta compile,
ğŸ”¸ Llama internamente al mojo CompilerMojo.execute().




ğŸ“¦ d) Artifact Resolver

Encargado de resolver dependencias y plugins desde repositorios.

Flujo interno:

Lee las coordenadas (groupId, artifactId, version, type, classifier).

Busca en el repositorio local (~/.m2/repository).

Si no existe, consulta los remotos definidos en settings.xml o en el POM.

Verifica checksums y firma.

Descarga el .jar y lo almacena localmente.

â¡ï¸ Utiliza la librerÃ­a Aether (hoy parte de org.eclipse.aether) para resoluciÃ³n y cachÃ© inteligente.

ğŸ“˜ Importante:
Maven no descarga dos veces un mismo artifact, y maneja â€œnearest-winsâ€ en conflictos de versiÃ³n.










ğŸ”¹ 3. ConstrucciÃ³n del Ã¡rbol de proyectos (Multi-Module Build)

Maven primero analiza todos los pom.xml de los mÃ³dulos y crea un Ã¡rbol de dependencias local, que incluye:

Dependencias internas (<dependency> entre mÃ³dulos locales)

Dependencias externas (resueltas vÃ­a repositorio)

Dependencias transitivas

Luego:

Usa el Reactor para ordenar los mÃ³dulos.

Pasa el control al Lifecycle Executor para ejecutar fases sobre cada uno.

Cada mÃ³dulo tiene su propio MavenProject en memoria.

ğŸ“ˆ AsÃ­, Maven garantiza que los mÃ³dulos dependientes se construyan solo cuando sus dependencias locales estÃ©n listas.






ğŸ”¹ 4. El rol de maven-core y maven-model-builder
Componente	Rol
maven-core	NÃºcleo del sistema: inicializa el MavenSession, gestiona los ciclos de vida (LifecycleExecutor), los repositorios y el reactor.
maven-model-builder	Encargado de leer y combinar pom.xml, padres, BOMs y perfiles para generar un Model completo.
maven-artifact	Representa cada artefacto (JAR, POM, WAR).
maven-plugin-api	Define la interfaz para desarrollar plugins (clases Mojo).
ğŸ§  En resumen

Cuando ejecutas mvn install, Maven:

Lee y combina los POMs â†’ maven-model-builder

Construye el grafo de mÃ³dulos â†’ Reactor

Resuelve dependencias â†’ Artifact Resolver

Ejecuta fases â†’ LifecycleExecutor (parte de maven-core)

Invoca plugins â†’ Plugin Manager

Instala artefactos resultantes en el repo local.